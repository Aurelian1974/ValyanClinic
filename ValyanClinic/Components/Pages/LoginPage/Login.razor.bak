@page "/login"
@layout ValyanClinic.Components.Layout.EmptyLayout
@using ValyanClinic.Domain.Models
@using ValyanClinic.Domain.Enums
@rendermode InteractiveServer

<PageTitle>Autentificare - ValyanMed</PageTitle>

<HeadContent>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="accept-charset" content="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</HeadContent>

<!-- Container principal unificat -->
<div class="login-page-wrapper">
    
    <!-- Single Unified Container -->
    <div class="login-unified-card">
        
        <!-- Header cu logo ?i titlu -->
        <div class="login-header">
            <div class="login-logo-section">
                <div class="login-logo">
                    <img src="/images/valyanmed-logo.png" alt="ValyanMed Logo" />
                    <i class="fas fa-user-md"></i>
                </div>
            </div>
            
            <div class="login-title-section">
                <h1 class="login-main-title">ValyanMed</h1>
                <p class="login-subtitle">Clinic Management System</p>
            </div>
        </div>

        <!-- Separator elegant -->
        <div class="login-separator"></div>

        <!-- Welcome Message -->
        <div class="login-welcome">
            <h2 class="welcome-title">Bine a?i revenit!</h2>
            <p class="welcome-text">Introduce?i datele pentru a accesa aplica?ia</p>
        </div>

        <!-- Login Form -->
        <form class="login-form" @onsubmit="HandleLogin" @onsubmit:preventDefault="true">
            
            <!-- Username Field -->
            <div class="form-group">
                <label class="form-label" for="username">
                    <i class="fas fa-user"></i>
                    Nume utilizator
                </label>
                <input type="text" 
                       id="username"
                       class="form-input @(_state.HasValidationErrors && _state.ValidationErrors.Any(e => e.Contains("utilizator")) ? "error" : "")"
                       placeholder="Introduce?i numele de utilizator"
                       @bind="_state.LoginRequest.Username"
                       @onkeypress="HandleKeyPress"
                       disabled="@_state.IsLoading"
                       autocomplete="username" />
                
                @if (_state.HasValidationErrors)
                {
                    @foreach (var error in _state.ValidationErrors.Where(e => e.Contains("utilizator")))
                    {
                        <div class="form-error">
                            <i class="fas fa-exclamation-circle"></i>
                            @error
                        </div>
                    }
                }
            </div>

            <!-- Password Field -->
            <div class="form-group">
                <label class="form-label" for="password">
                    <i class="fas fa-lock"></i>
                    Parol?
                </label>
                <div class="password-wrapper">
                    <input type="@_state.PasswordInputType" 
                           id="password"
                           class="form-input @(_state.HasValidationErrors && _state.ValidationErrors.Any(e => e.Contains("parola") || e.Contains("Parola")) ? "error" : "")"
                           placeholder="Introduce?i parola"
                           @bind="_state.LoginRequest.Password"
                           @onkeypress="HandleKeyPress"
                           disabled="@_state.IsLoading"
                           autocomplete="current-password" />
                    
                    <button type="button" 
                            class="password-toggle"
                            @onclick="TogglePasswordVisibility"
                            disabled="@_state.IsLoading">
                        <i class="fas @_state.PasswordToggleIcon"></i>
                    </button>
                </div>
                
                @if (_state.HasValidationErrors)
                {
                    @foreach (var error in _state.ValidationErrors.Where(e => e.Contains("parola") || e.Contains("Parola")))
                    {
                        <div class="form-error">
                            <i class="fas fa-exclamation-circle"></i>
                            @error
                        </div>
                    }
                }
            </div>

            <!-- Form Options -->
            <div class="form-options">
                <label class="remember-checkbox">
                    <input type="checkbox" 
                           @bind="_state.LoginRequest.RememberMe"
                           disabled="@_state.IsLoading" />
                    <span class="checkmark"></span>
                    <span class="checkbox-text">?ine-m? minte</span>
                </label>
                
                <a href="#" class="forgot-link" @onclick="HandleForgotPassword" @onclick:preventDefault="true">
                    Ai uitat parola?
                </a>
            </div>

            <!-- Login Button -->
            <button type="submit" 
                    class="login-button @(_state.IsLoading ? "loading" : "")"
                    disabled="@(!_state.CanAttemptLogin())">
                
                @if (_state.IsLoading)
                {
                    <div class="button-spinner"></div>
                    <span>Se autentific?...</span>
                }
                else if (_state.IsAccountLocked)
                {
                    <i class="fas fa-lock"></i>
                    <span>Cont blocat</span>
                }
                else
                {
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Intr? în aplica?ie</span>
                }
            </button>

            <!-- Error Messages -->
            @if (!string.IsNullOrEmpty(_state.ErrorMessage))
            {
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>@_state.ErrorMessage</span>
                </div>
            }

            @if (_state.IsAccountLocked && !string.IsNullOrEmpty(_state.GetLockoutMessage()))
            {
                <div class="warning-message">
                    <i class="fas fa-lock"></i>
                    <span>@_state.GetLockoutMessage()</span>
                </div>
            }

        </form>

        <!-- Footer -->
        <div class="login-footer">
            <div class="security-notice">
                <i class="fas fa-shield-alt"></i>
                <span>Conexiune securizat? ?i criptat?</span>
            </div>
            
            <div class="footer-links">
                <div class="copyright">© 2025 ValyanMed. Toate drepturile rezervate.</div>
                <a href="#" @onclick="ShowContactSupport" @onclick:preventDefault="true" class="support-link">
                    <i class="fas fa-headset"></i>
                    Suport tehnic
                </a>
            </div>
        </div>

    </div>
    
</div>