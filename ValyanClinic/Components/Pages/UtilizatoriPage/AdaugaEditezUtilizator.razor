@using ValyanClinic.Domain.Models
@using ValyanClinic.Domain.Enums
@using ValyanClinic.Application.Services
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.DropDowns
@using Syncfusion.Blazor.Buttons
@using Syncfusion.Blazor.Notifications
@rendermode InteractiveServer

<link href="~/css/pages/add-edit-user-syncfusion.css" rel="stylesheet" />

<div class="add-edit-user-modal-content">
    @if (HasError)
    {
        <div class="add-edit-user-alert add-edit-user-alert-danger">
            <i class="fas fa-exclamation-triangle"></i>
            @ErrorMessage
        </div>
    }

    @if (IsLoading)
    {
        <div class="add-edit-user-loading-container">
            <div class="add-edit-user-loading-indicator">
                <i class="fas fa-spinner fa-spin"></i>
                <span>Se incarc?...</span>
            </div>
        </div>
    }
    else
    {
        <div class="add-edit-user-form-container">
            <EditForm Model="@CurrentUser" OnValidSubmit="SaveUser" id="addEditUserForm">
                <DataAnnotationsValidator />
                
                <div class="add-edit-user-form-sections">
                    @* Personal Information Section *@
                    <div class="add-edit-user-form-section">
                        <h3 class="add-edit-user-section-title">
                            <i class="fas fa-id-card"></i>
                            Informaii Personale
                        </h3>
                        
                        <div class="add-edit-user-form-row">
                            <div class="add-edit-user-form-group">
                                <label class="add-edit-user-form-label">
                                    Nume <span class="add-edit-user-required">*</span>
                                </label>
                                <SfTextBox @bind-Value="CurrentUser.FirstName" 
                                          Placeholder="Introducei numele"
                                          CssClass="form-control">
                                </SfTextBox>
                                <ValidationMessage For="@(() => CurrentUser.FirstName)" class="add-edit-user-validation-error" />
                            </div>
                            
                            <div class="add-edit-user-form-group">
                                <label class="add-edit-user-form-label">
                                    Prenume <span class="add-edit-user-required">*</span>
                                </label>
                                <SfTextBox @bind-Value="CurrentUser.LastName" 
                                          Placeholder="Introducei prenumele"
                                          CssClass="form-control">
                                </SfTextBox>
                                <ValidationMessage For="@(() => CurrentUser.LastName)" class="add-edit-user-validation-error" />
                            </div>
                        </div>
                        
                        <div class="add-edit-user-form-row">
                            <div class="add-edit-user-form-group">
                                <label class="add-edit-user-form-label">
                                    Email <span class="add-edit-user-required">*</span>
                                </label>
                                <SfTextBox @bind-Value="CurrentUser.Email" 
                                          Placeholder="utilizator@valyanmed.ro"
                                          CssClass="form-control">
                                </SfTextBox>
                                <ValidationMessage For="@(() => CurrentUser.Email)" class="add-edit-user-validation-error" />
                            </div>
                            
                            <div class="add-edit-user-form-group">
                                <label class="add-edit-user-form-label">Telefon</label>
                                <SfTextBox @bind-Value="CurrentUser.Phone" 
                                          Placeholder="0723456789"
                                          CssClass="form-control">
                                </SfTextBox>
                                <ValidationMessage For="@(() => CurrentUser.Phone)" class="add-edit-user-validation-error" />
                            </div>
                        </div>
                    </div>
                    
                    @* Account Information Section *@
                    <div class="add-edit-user-form-section">
                        <h3 class="add-edit-user-section-title">
                            <i class="fas fa-user-cog"></i>
                            Informaii Cont
                        </h3>
                        
                        <div class="add-edit-user-form-row">
                            <div class="add-edit-user-form-group">
                                <label class="add-edit-user-form-label">
                                    Username <span class="add-edit-user-required">*</span>
                                </label>
                                <SfTextBox @bind-Value="CurrentUser.Username" 
                                          Placeholder="username_utilizator"
                                          CssClass="form-control">
                                </SfTextBox>
                                <ValidationMessage For="@(() => CurrentUser.Username)" class="add-edit-user-validation-error" />
                            </div>
                            
                            <div class="add-edit-user-form-group">
                                <label class="add-edit-user-form-label">
                                    Rol in Sistem <span class="add-edit-user-required">*</span>
                                </label>
                                <SfDropDownList TItem="UserRole" TValue="UserRole" 
                                               @bind-Value="CurrentUser.Role"
                                               DataSource="@AllRoles"
                                               Placeholder="Selecteaz? rolul"
                                               CssClass="form-control">
                                    <DropDownListTemplates TItem="UserRole">
                                        <ItemTemplate Context="roleContext">
                                            @GetRoleDisplayName(roleContext)
                                        </ItemTemplate>
                                    </DropDownListTemplates>
                                </SfDropDownList>
                                <ValidationMessage For="@(() => CurrentUser.Role)" class="add-edit-user-validation-error" />
                            </div>
                        </div>
                        
                        <div class="add-edit-user-form-row">
                            <div class="add-edit-user-form-group">
                                <label class="add-edit-user-form-label">Status</label>
                                <SfDropDownList TItem="UserStatus" TValue="UserStatus" 
                                               @bind-Value="CurrentUser.Status"
                                               DataSource="@AllStatuses"
                                               Placeholder="Selecteaz? statusul"
                                               CssClass="form-control">
                                    <DropDownListTemplates TItem="UserStatus">
                                        <ItemTemplate Context="statusContext">
                                            @GetStatusDisplayName(statusContext)
                                        </ItemTemplate>
                                    </DropDownListTemplates>
                                </SfDropDownList>
                            </div>
                            <div class="add-edit-user-form-group">
                                <!-- Empty for layout -->
                            </div>
                        </div>
                    </div>
                    
                    @* Organizational Information Section *@
                    <div class="add-edit-user-form-section">
                        <h3 class="add-edit-user-section-title">
                            <i class="fas fa-building"></i>
                            Informaii Organizaionale
                        </h3>
                        
                        <div class="add-edit-user-form-row">
                            <div class="add-edit-user-form-group">
                                <label class="add-edit-user-form-label">Departament</label>
                                <SfDropDownList TItem="string" TValue="string" 
                                               @bind-Value="CurrentUser.Department"
                                               DataSource="@DepartmentOptions"
                                               Placeholder="Selecteaz? departamentul"
                                               AllowFiltering="true"
                                               CssClass="form-control">
                                </SfDropDownList>
                            </div>
                            
                            <div class="add-edit-user-form-group">
                                <label class="add-edit-user-form-label">Funcia</label>
                                <SfTextBox @bind-Value="CurrentUser.JobTitle" 
                                          Placeholder="ex: Medic Specialist, Asistent Medical"
                                          CssClass="form-control">
                                </SfTextBox>
                            </div>
                        </div>
                    </div>
                </div>
            </EditForm>
        </div>
    }
</div>