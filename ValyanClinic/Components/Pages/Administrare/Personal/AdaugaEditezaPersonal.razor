@using ValyanClinic.Domain.Models
@using ValyanClinic.Domain.Enums
@using ValyanClinic.Application.Services
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.DropDowns
@using Syncfusion.Blazor.Calendars
@using Syncfusion.Blazor.Buttons
@using Microsoft.AspNetCore.Components.Forms
@rendermode InteractiveServer
@using PersonalModel = ValyanClinic.Domain.Models.Personal

<div class="personal-form-container">
    <div class="form-header">
        <h2>@(IsEditMode ? "Editează Personal" : "Adaugă Personal Nou")</h2>
    </div>

    @if (validationErrors.Any())
    {
        <div class="alert alert-danger">
            <ul>
                @foreach (var error in validationErrors)
                {
                    <li>@error.ErrorMessage</li>
                }
            </ul>
        </div>
    }

    <EditForm Model="@personalFormModel" OnValidSubmit="HandleSubmit">
        <!-- Secțiunea: Date de Identificare -->
        <div class="form-section">
            <h3>Date de Identificare</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label for="nume">Nume *</label>
                    <SfTextBox @bind-Value="@personalFormModel.Nume" 
                              ID="nume" 
                              Placeholder="Introduceți numele" 
                              Width="100%"
                              MaxLength="100">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Nume)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Nume)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="prenume">Prenume *</label>
                    <SfTextBox @bind-Value="@personalFormModel.Prenume" 
                              ID="prenume" 
                              Placeholder="Introduceți prenumele" 
                              Width="100%"
                              MaxLength="100">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Prenume)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Prenume)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="nume-anterior">Nume Anterior</label>
                    <SfTextBox @bind-Value="@personalFormModel.Nume_Anterior" 
                              ID="nume-anterior" 
                              Placeholder="Pentru femei căsătorite" 
                              Width="100%"
                              MaxLength="100">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Nume_Anterior)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Nume_Anterior)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="cnp">CNP *</label>
                    <SfTextBox @bind-Value="@personalFormModel.CNP" 
                              ID="cnp" 
                              Placeholder="Introduceți CNP-ul (13 cifre)" 
                              Width="100%"
                              MaxLength="13">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.CNP)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.CNP)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="cod-angajat">Cod Angajat *</label>
                    <SfTextBox @bind-Value="@personalFormModel.Cod_Angajat" 
                              ID="cod-angajat" 
                              Placeholder="Ex: EMP001" 
                              Width="100%"
                              MaxLength="20">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Cod_Angajat)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Cod_Angajat)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="data-nasterii">Data Nașterii *</label>
                    <SfDatePicker @bind-Value="@personalFormModel.Data_Nasterii" 
                                 ID="data-nasterii" 
                                 Format="dd/MM/yyyy" 
                                 Width="100%">
                    </SfDatePicker>
                    @if (HasFieldErrors(nameof(PersonalModel.Data_Nasterii)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Data_Nasterii)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="locul-nasterii">Locul Nașterii</label>
                    <SfTextBox @bind-Value="@personalFormModel.Locul_Nasterii" 
                              ID="locul-nasterii" 
                              Placeholder="Ex: București, România" 
                              Width="100%"
                              MaxLength="200">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Locul_Nasterii)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Locul_Nasterii)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="nationalitate">Naționalitate</label>
                    <SfTextBox @bind-Value="@personalFormModel.Nationalitate" 
                              ID="nationalitate" 
                              Placeholder="Ex: Română" 
                              Width="100%"
                              MaxLength="50">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Nationalitate)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Nationalitate)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="cetatenie">Cetățenie</label>
                    <SfTextBox @bind-Value="@personalFormModel.Cetatenie" 
                              ID="cetatenie" 
                              Placeholder="Ex: Română" 
                              Width="100%"
                              MaxLength="50">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Cetatenie)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Cetatenie)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="stare-civila">Stare Civilă</label>
                    <SfDropDownList @bind-Value="@personalFormModel.Stare_Civila" 
                                   ID="stare-civila" 
                                   DataSource="@stareCivilaOptions" 
                                   Width="100%"
                                   AllowFiltering="true">
                        <DropDownListFieldSettings Text="Text" Value="Value" />
                    </SfDropDownList>
                    @if (HasFieldErrors(nameof(PersonalModel.Stare_Civila)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Stare_Civila)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Secțiunea: Informații de Contact -->
        <div class="form-section">
            <h3>Informații de Contact</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label for="telefon-personal">Telefon Personal</label>
                    <SfTextBox @bind-Value="@personalFormModel.Telefon_Personal" 
                              ID="telefon-personal" 
                              Placeholder="Ex: 0723456789" 
                              Width="100%"
                              MaxLength="20">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Telefon_Personal)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Telefon_Personal)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="telefon-serviciu">Telefon Serviciu</label>
                    <SfTextBox @bind-Value="@personalFormModel.Telefon_Serviciu" 
                              ID="telefon-serviciu" 
                              Placeholder="Ex: 0312345678" 
                              Width="100%"
                              MaxLength="20">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Telefon_Serviciu)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Telefon_Serviciu)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="email-personal">Email Personal</label>
                    <SfTextBox @bind-Value="@personalFormModel.Email_Personal" 
                              ID="email-personal" 
                              Placeholder="Ex: nume@email.com" 
                              Width="100%"
                              MaxLength="100">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Email_Personal)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Email_Personal)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="email-serviciu">Email Serviciu</label>
                    <SfTextBox @bind-Value="@personalFormModel.Email_Serviciu" 
                              ID="email-serviciu" 
                              Placeholder="Ex: nume@valyanclinic.ro" 
                              Width="100%"
                              MaxLength="100">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Email_Serviciu)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Email_Serviciu)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Secțiunea: Adresa de Domiciliu -->
        <div class="form-section">
            <h3>Adresa de Domiciliu</h3>
            <div class="form-grid">
                <div class="form-group full-width">
                    <label for="adresa-domiciliu">Adresa Domiciliu *</label>
                    <SfTextBox @bind-Value="@personalFormModel.Adresa_Domiciliu" 
                              ID="adresa-domiciliu" 
                              Placeholder="Ex: Str. Mihai Eminescu, nr. 15, bl. A1, sc. B, et. 2, ap. 25" 
                              Width="100%"
                              Multiline="true">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Adresa_Domiciliu)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Adresa_Domiciliu)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="judet-domiciliu">Județ Domiciliu *</label>
                    <SfDropDownList @bind-Value="@personalFormModel.Judet_Domiciliu" 
                                   ID="judet-domiciliu" 
                                   DataSource="@judeteOptions" 
                                   Width="100%"
                                   AllowFiltering="true">
                        <DropDownListFieldSettings Text="Text" Value="Value" />
                    </SfDropDownList>
                    @if (HasFieldErrors(nameof(PersonalModel.Judet_Domiciliu)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Judet_Domiciliu)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="oras-domiciliu">Oraș Domiciliu *</label>
                    <SfTextBox @bind-Value="@personalFormModel.Oras_Domiciliu" 
                              ID="oras-domiciliu" 
                              Placeholder="Ex: București" 
                              Width="100%"
                              MaxLength="100">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Oras_Domiciliu)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Oras_Domiciliu)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="cod-postal-domiciliu">Cod Poștal Domiciliu</label>
                    <SfTextBox @bind-Value="@personalFormModel.Cod_Postal_Domiciliu" 
                              ID="cod-postal-domiciliu" 
                              Placeholder="Ex: 012345" 
                              Width="100%"
                              MaxLength="10">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Cod_Postal_Domiciliu)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Cod_Postal_Domiciliu)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Secțiunea: Adresa de Reședință -->
        <div class="form-section">
            <h3>Adresa de Reședință (dacă diferă de domiciliu)</h3>
            <div class="form-grid">
                <div class="form-group full-width">
                    <label for="adresa-resedinta">Adresa Reședință</label>
                    <SfTextBox @bind-Value="@personalFormModel.Adresa_Resedinta" 
                              ID="adresa-resedinta" 
                              Placeholder="Completați doar dacă diferă de domiciliu" 
                              Width="100%"
                              Multiline="true">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Adresa_Resedinta)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Adresa_Resedinta)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="judet-resedinta">Județ Reședință</label>
                    <SfDropDownList @bind-Value="@personalFormModel.Judet_Resedinta" 
                                   ID="judet-resedinta" 
                                   DataSource="@judeteOptions" 
                                   Width="100%"
                                   AllowFiltering="true">
                        <DropDownListFieldSettings Text="Text" Value="Value" />
                    </SfDropDownList>
                    @if (HasFieldErrors(nameof(PersonalModel.Judet_Resedinta)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Judet_Resedinta)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="oras-resedinta">Oraș Reședință</label>
                    <SfTextBox @bind-Value="@personalFormModel.Oras_Resedinta" 
                              ID="oras-resedinta" 
                              Placeholder="Ex: Cluj-Napoca" 
                              Width="100%"
                              MaxLength="100">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Oras_Resedinta)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Oras_Resedinta)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="cod-postal-resedinta">Cod Poștal Reședință</label>
                    <SfTextBox @bind-Value="@personalFormModel.Cod_Postal_Resedinta" 
                              ID="cod-postal-resedinta" 
                              Placeholder="Ex: 400001" 
                              Width="100%"
                              MaxLength="10">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Cod_Postal_Resedinta)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Cod_Postal_Resedinta)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Secțiunea: Date Profesionale -->
        <div class="form-section">
            <h3>Date Profesionale</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label for="functia">Funcția *</label>
                    <SfTextBox @bind-Value="@personalFormModel.Functia" 
                              ID="functia" 
                              Placeholder="Ex: Manager, Specialist, Asistent medical" 
                              Width="100%"
                              MaxLength="100">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Functia)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Functia)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="departament">Departament *</label>
                    <SfDropDownList @bind-Value="@personalFormModel.Departament" 
                                   ID="departament" 
                                   DataSource="@departmentOptions" 
                                   Width="100%"
                                   AllowFiltering="true">
                        <DropDownListFieldSettings Text="Text" Value="Value" />
                    </SfDropDownList>
                    @if (HasFieldErrors(nameof(PersonalModel.Departament)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Departament)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="status-angajat">Status Angajat</label>
                    <SfDropDownList @bind-Value="@personalFormModel.Status_Angajat" 
                                   ID="status-angajat" 
                                   DataSource="@statusAngajatOptions" 
                                   Width="100%">
                        <DropDownListFieldSettings Text="Text" Value="Value" />
                    </SfDropDownList>
                    @if (HasFieldErrors(nameof(PersonalModel.Status_Angajat)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Status_Angajat)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Secțiunea: Documente de Identitate -->
        <div class="form-section">
            <h3>Documente de Identitate</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label for="serie-ci">Serie CI</label>
                    <SfTextBox @bind-Value="@personalFormModel.Serie_CI" 
                              ID="serie-ci" 
                              Placeholder="Ex: AB" 
                              Width="100%"
                              MaxLength="10">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Serie_CI)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Serie_CI)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="numar-ci">Număr CI</label>
                    <SfTextBox @bind-Value="@personalFormModel.Numar_CI" 
                              ID="numar-ci" 
                              Placeholder="Ex: 123456" 
                              Width="100%"
                              MaxLength="20">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Numar_CI)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Numar_CI)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="eliberat-ci-de">Eliberat CI De</label>
                    <SfTextBox @bind-Value="@personalFormModel.Eliberat_CI_De" 
                              ID="eliberat-ci-de" 
                              Placeholder="Ex: SPCLEP București" 
                              Width="100%"
                              MaxLength="100">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Eliberat_CI_De)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Eliberat_CI_De)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="data-eliberare-ci">Data Eliberare CI</label>
                    <SfDatePicker @bind-Value="@personalFormModel.Data_Eliberare_CI" 
                                 ID="data-eliberare-ci" 
                                 Format="dd/MM/yyyy" 
                                 Width="100%">
                    </SfDatePicker>
                    @if (HasFieldErrors(nameof(PersonalModel.Data_Eliberare_CI)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Data_Eliberare_CI)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label for="valabil-ci-pana">Valid CI Până</label>
                    <SfDatePicker @bind-Value="@personalFormModel.Valabil_CI_Pana" 
                                 ID="valabil-ci-pana" 
                                 Format="dd/MM/yyyy" 
                                 Width="100%">
                    </SfDatePicker>
                    @if (HasFieldErrors(nameof(PersonalModel.Valabil_CI_Pana)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Valabil_CI_Pana)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Secțiunea: Observații -->
        <div class="form-section">
            <h3>Observații</h3>
            <div class="form-grid">
                <div class="form-group full-width">
                    <label for="observatii">Observații</label>
                    <SfTextBox @bind-Value="@personalFormModel.Observatii" 
                              ID="observatii" 
                              Placeholder="Observații generale despre angajat..." 
                              Width="100%"
                              Multiline="true">
                    </SfTextBox>
                    @if (HasFieldErrors(nameof(PersonalModel.Observatii)))
                    {
                        <div class="validation-error">
                            @foreach (var error in GetFieldErrors(nameof(PersonalModel.Observatii)))
                            {
                                <div>@error</div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="form-buttons">
            <SfButton CssClass="e-primary" IsPrimary="true" disabled="@isSubmitting">
                @(IsEditMode ? "Actualizează" : "Adaugă") Personal
            </SfButton>
            <SfButton CssClass="e-outline" @onclick="HandleCancel">
                Anulează
            </SfButton>
        </div>
    </EditForm>
</div>
