@using ValyanClinic.Domain.Models
@using ValyanClinic.Domain.Enums
@using ValyanClinic.Application.Services
@using ValyanClinic.Application.Interfaces
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.DropDowns
@using Syncfusion.Blazor.Calendars
@using Syncfusion.Blazor.Buttons
@using Microsoft.AspNetCore.Components.Forms
@rendermode InteractiveServer
@using PersonalModel = ValyanClinic.Domain.Models.Personal

<link href="/css/pages/view-personal-syncfusion.css" rel="stylesheet" />
<link href="/css/components/location-dependent-grid-dropdowns.css" rel="stylesheet" />

<div class="view-personal-modal-content">
    <!-- Content area cu scroll -->
    <div class="view-personal-content-area">
        @* Header Section *@
        <div class="personal-details-dashboard">
            <div class="detail-card">
                <div class="card-header">
                    <i class="fas fa-user-plus"></i>
                    <h3>@(IsEditMode ? "Editeaza Personal" : "Adauga Personal Nou")</h3>
                </div>
                <div class="card-content">
                    @if (IsEditMode && EditingPersonal != null)
                    {
                        <div class="form-grid">
                            <div class="form-field">
                                <label>Nume Complet</label>
                                <span class="field-value">@EditingPersonal.NumeComplet</span>
                            </div>
                            <div class="form-field">
                                <label>Cod Angajat</label>
                                <span class="field-value">@EditingPersonal.Cod_Angajat</span>
                            </div>
                        </div>
                    }
                    else
                    {
                        <p class="field-value" style="margin: 0; color: #6b7280;">Completează formularul pentru a adăuga un nou angajat în sistem.</p>
                    }
                </div>
            </div>
        </div>

        @* Validation Errors *@
        @if (validationErrors.Any())
        {
            <div class="error-message">
                <i class="fas fa-exclamation-triangle"></i>
                <div>
                    <strong>Erori de validare:</strong>
                    <ul style="margin: 8px 0 0 0;">
                        @foreach (var error in validationErrors)
                        {
                            <li>@error.ErrorMessage</li>
                        }
                    </ul>
                </div>
            </div>
        }

        <EditForm Model="@personalFormModel" OnValidSubmit="HandleSubmit">
            <div class="personal-details-dashboard">
                
                @* Date de Identificare Card *@
                <div class="detail-card">
                    <div class="card-header">
                        <i class="fas fa-id-card"></i>
                        <h3>Date de Identificare</h3>
                    </div>
                    <div class="card-content">
                        <div class="form-grid">
                            <div class="form-field">
                                <label>Nume *</label>
                                <SfTextBox @bind-Value="@personalFormModel.Nume" 
                                          Placeholder="Introduceti numele" 
                                          Width="100%"
                                          MaxLength="100">
                                </SfTextBox>
                                @if (HasFieldErrors(nameof(PersonalModel.Nume)))
                                {
                                    <div class="field-error">
                                        @foreach (var error in GetFieldErrors(nameof(PersonalModel.Nume)))
                                        {
                                            <small>@error</small>
                                        }
                                    </div>
                                }
                            </div>

                            <div class="form-field">
                                <label>Prenume *</label>
                                <SfTextBox @bind-Value="@personalFormModel.Prenume" 
                                          Placeholder="Introduceti prenumele" 
                                          Width="100%"
                                          MaxLength="100">
                                </SfTextBox>
                                @if (HasFieldErrors(nameof(PersonalModel.Prenume)))
                                {
                                    <div class="field-error">
                                        @foreach (var error in GetFieldErrors(nameof(PersonalModel.Prenume)))
                                        {
                                            <small>@error</small>
                                        }
                                    </div>
                                }
                            </div>

                            <div class="form-field">
                                <label>Nume Anterior</label>
                                <SfTextBox @bind-Value="@personalFormModel.Nume_Anterior" 
                                          Placeholder="Pentru femei casatorite" 
                                          Width="100%"
                                          MaxLength="100">
                                </SfTextBox>
                            </div>

                            <div class="form-field">
                                <label>CNP *</label>
                                <SfTextBox @bind-Value="@personalFormModel.CNP" 
                                          Placeholder="Introduceti CNP-ul (13 cifre)" 
                                          Width="100%"
                                          MaxLength="13">
                                </SfTextBox>
                                @if (HasFieldErrors(nameof(PersonalModel.CNP)))
                                {
                                    <div class="field-error">
                                        @foreach (var error in GetFieldErrors(nameof(PersonalModel.CNP)))
                                        {
                                            <small>@error</small>
                                        }
                                    </div>
                                }
                            </div>

                            <div class="form-field">
                                <label>Cod Angajat *</label>
                                <SfTextBox @bind-Value="@personalFormModel.Cod_Angajat" 
                                          Placeholder="Ex: EMP001" 
                                          Width="100%"
                                          MaxLength="20">
                                </SfTextBox>
                                @if (HasFieldErrors(nameof(PersonalModel.Cod_Angajat)))
                                {
                                    <div class="field-error">
                                        @foreach (var error in GetFieldErrors(nameof(PersonalModel.Cod_Angajat)))
                                        {
                                            <small>@error</small>
                                        }
                                    </div>
                                }
                            </div>

                            <div class="form-field">
                                <label>Data Nasterii *</label>
                                <SfDatePicker @bind-Value="@personalFormModel.Data_Nasterii" 
                                             Format="dd/MM/yyyy" 
                                             Width="100%">
                                </SfDatePicker>
                                @if (HasFieldErrors(nameof(PersonalModel.Data_Nasterii)))
                                {
                                    <div class="field-error">
                                        @foreach (var error in GetFieldErrors(nameof(PersonalModel.Data_Nasterii)))
                                        {
                                            <small>@error</small>
                                        }
                                    </div>
                                }
                            </div>

                            <div class="form-field">
                                <label>Locul Nasterii</label>
                                <SfTextBox @bind-Value="@personalFormModel.Locul_Nasterii" 
                                          Placeholder="Ex: Bucuresti, Romania" 
                                          Width="100%"
                                          MaxLength="200">
                                </SfTextBox>
                            </div>

                            <div class="form-field">
                                <label>Nationalitate</label>
                                <SfTextBox @bind-Value="@personalFormModel.Nationalitate" 
                                          Placeholder="Ex: Romana" 
                                          Width="100%"
                                          MaxLength="50">
                                </SfTextBox>
                            </div>

                            <div class="form-field">
                                <label>Cetatenie</label>
                                <SfTextBox @bind-Value="@personalFormModel.Cetatenie" 
                                          Placeholder="Ex: Romana" 
                                          Width="100%"
                                          MaxLength="50">
                                </SfTextBox>
                            </div>

                            <div class="form-field">
                                <label>Stare Civila</label>
                                <SfDropDownList @bind-Value="@personalFormModel.Stare_Civila" 
                                               DataSource="@stareCivilaOptions" 
                                               Width="100%"
                                               AllowFiltering="true">
                                    <DropDownListFieldSettings Text="Text" Value="Value" />
                                </SfDropDownList>
                            </div>
                        </div>
                    </div>
                </div>

                @* Date Profesionale Card *@
                <div class="detail-card">
                    <div class="card-header">
                        <i class="fas fa-briefcase"></i>
                        <h3>Date Profesionale</h3>
                    </div>
                    <div class="card-content">
                        <div class="form-grid">
                            <div class="form-field">
                                <label>Functia *</label>
                                <SfTextBox @bind-Value="@personalFormModel.Functia" 
                                          Placeholder="Ex: Manager, Specialist, Asistent medical" 
                                          Width="100%"
                                          MaxLength="100">
                                </SfTextBox>
                                @if (HasFieldErrors(nameof(PersonalModel.Functia)))
                                {
                                    <div class="field-error">
                                        @foreach (var error in GetFieldErrors(nameof(PersonalModel.Functia)))
                                        {
                                            <small>@error</small>
                                        }
                                    </div>
                                }
                            </div>

                            <div class="form-field">
                                <label>Departament *</label>
                                <SfDropDownList @bind-Value="@personalFormModel.Departament" 
                                               DataSource="@departmentOptions" 
                                               Width="100%"
                                               AllowFiltering="true">
                                    <DropDownListFieldSettings Text="Text" Value="Value" />
                                </SfDropDownList>
                                @if (HasFieldErrors(nameof(PersonalModel.Departament)))
                                {
                                    <div class="field-error">
                                        @foreach (var error in GetFieldErrors(nameof(PersonalModel.Departament)))
                                        {
                                            <small>@error</small>
                                        }
                                    </div>
                                }
                            </div>

                            <div class="form-field">
                                <label>Status Angajat</label>
                                <SfDropDownList @bind-Value="@personalFormModel.Status_Angajat" 
                                               DataSource="@statusAngajatOptions" 
                                               Width="100%">
                                    <DropDownListFieldSettings Text="Text" Value="Value" />
                                </SfDropDownList>
                            </div>
                        </div>
                    </div>
                </div>

                @* Informatii de Contact Card *@
                <div class="detail-card">
                    <div class="card-header">
                        <i class="fas fa-address-book"></i>
                        <h3>Informatii de Contact</h3>
                    </div>
                    <div class="card-content">
                        <div class="form-grid">
                            <div class="form-field">
                                <label>Telefon Personal</label>
                                <SfTextBox @bind-Value="@personalFormModel.Telefon_Personal" 
                                          Placeholder="Ex: 0723456789" 
                                          Width="100%"
                                          MaxLength="20">
                                </SfTextBox>
                            </div>

                            <div class="form-field">
                                <label>Telefon Serviciu</label>
                                <SfTextBox @bind-Value="@personalFormModel.Telefon_Serviciu" 
                                          Placeholder="Ex: 0312345678" 
                                          Width="100%"
                                          MaxLength="20">
                                </SfTextBox>
                            </div>

                            <div class="form-field full-width">
                                <label>Email Personal</label>
                                <SfTextBox @bind-Value="@personalFormModel.Email_Personal" 
                                          Placeholder="Ex: nume@email.com" 
                                          Width="100%"
                                          MaxLength="100">
                                </SfTextBox>
                            </div>

                            <div class="form-field full-width">
                                <label>Email Serviciu</label>
                                <SfTextBox @bind-Value="@personalFormModel.Email_Serviciu" 
                                          Placeholder="Ex: nume@valyanclinic.ro" 
                                          Width="100%"
                                          MaxLength="100">
                                </SfTextBox>
                            </div>
                        </div>
                    </div>
                </div>

                @* Adresa de Domiciliu Card *@
                <div class="detail-card">
                    <div class="card-header">
                        <i class="fas fa-map-marker-alt"></i>
                        <h3>Adresa de Domiciliu</h3>
                    </div>
                    <div class="card-content">
                        <div class="form-grid">
                            <div class="form-field full-width">
                                <label>Adresa Domiciliu *</label>
                                <SfTextBox @bind-Value="@personalFormModel.Adresa_Domiciliu" 
                                          Placeholder="Ex: Str. Mihai Eminescu, nr. 15, bl. A1, sc. B, et. 2, ap. 25" 
                                          Width="100%"
                                          Multiline="true">
                                </SfTextBox>
                                @if (HasFieldErrors(nameof(PersonalModel.Adresa_Domiciliu)))
                                {
                                    <div class="field-error">
                                        @foreach (var error in GetFieldErrors(nameof(PersonalModel.Adresa_Domiciliu)))
                                        {
                                            <small>@error</small>
                                        }
                                    </div>
                                }
                            </div>

                            <!-- FOLOSIM COMPONENTA REUTILIZABILA LocationDependentGridDropdowns -->
                            <LocationDependentGridDropdowns 
                                SelectedJudetId="@selectedJudetDomiciliuId"
                                SelectedJudetIdChanged="@((int? value) => selectedJudetDomiciliuId = value)"
                                SelectedLocalitateId="@selectedLocalitateDomiciliuId"
                                SelectedLocalitateIdChanged="@((int? value) => selectedLocalitateDomiciliuId = value)"
                                JudetLabel="Județ Domiciliu *"
                                LocalitateLabel="Localitate Domiciliu *"
                                JudetPlaceholder="-- Selectează județul --"
                                LocalitatePlaceholder="-- Selectează localitatea --"
                                OnJudetNameChanged="@OnJudetDomiciliuNameChanged"
                                OnLocalitateNameChanged="@OnLocalitateDomiciliuNameChanged" />
                            <!-- end dropdown-uri location dependent -->

                            <div class="form-field">
                                <label>Cod Postal Domiciliu</label>
                                <SfTextBox @bind-Value="@personalFormModel.Cod_Postal_Domiciliu" 
                                          Placeholder="Ex: 012345" 
                                          Width="100%"
                                          MaxLength="10">
                                </SfTextBox>
                            </div>

                            @* Checkbox pentru a afișa secțiunea de reședință *@
                            <div class="form-field full-width">
                                <div class="checkbox-container">
                                    <SfCheckBox @bind-Checked="@showResedintaSection" 
                                              Label="Adresa de domiciliu este identica cu cea de resedinta"
                                              @onchange="@OnResedintaCheckboxChanged">
                                    </SfCheckBox>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                @* Adresa de Resedinta Card - Vizibil doar dacă checkbox-ul NU este bifat *@
                @if (!showResedintaSection)
                {
                    <div class="detail-card resedinta-card">
                        <div class="card-header">
                            <i class="fas fa-home"></i>
                            <h3>Adresa de Resedinta</h3>
                        </div>
                        <div class="card-content">
                            <div class="address-separator">
                                <span>Completati adresa de resedinta daca difera de domiciliu</span>
                            </div>
                            <div class="form-grid">
                                <div class="form-field full-width">
                                    <label>Adresa Resedinta</label>
                                    <SfTextBox @bind-Value="@personalFormModel.Adresa_Resedinta" 
                                              Placeholder="Ex: Str. Nicolae Balcescu, nr. 23, bl. C2, ap. 45" 
                                              Width="100%"
                                              Multiline="true">
                                    </SfTextBox>
                                </div>

                                <!-- FOLOSIM COMPONENTA REUTILIZABILA pentru Resedinta -->
                                <LocationDependentGridDropdowns 
                                    SelectedJudetId="@selectedJudetResedintaId"
                                    SelectedJudetIdChanged="@((int? value) => selectedJudetResedintaId = value)"
                                    SelectedLocalitateId="@selectedLocalitateResedintaId"
                                    SelectedLocalitateIdChanged="@((int? value) => selectedLocalitateResedintaId = value)"
                                    JudetLabel="Județ Reședință"
                                    LocalitateLabel="Localitate Reședință"
                                    JudetPlaceholder="-- Selectează județul --"
                                    LocalitatePlaceholder="-- Selectează localitatea --"
                                    OnJudetNameChanged="@OnJudetResedintaNameChanged"
                                    OnLocalitateNameChanged="@OnLocalitateResedintaNameChanged" />

                                <div class="form-field">
                                    <label>Cod Postal Resedinta</label>
                                    <SfTextBox @bind-Value="@personalFormModel.Cod_Postal_Resedinta" 
                                              Placeholder="Ex: 400001" 
                                              Width="100%"
                                              MaxLength="10">
                                    </SfTextBox>
                                </div>
                            </div>
                        </div>
                    </div>
                }

                @* Documente de Identitate Card *@
                <div class="detail-card">
                    <div class="card-header">
                        <i class="fas fa-id-badge"></i>
                        <h3>Documente de Identitate</h3>
                    </div>
                    <div class="card-content">
                        <div class="form-grid">
                            <div class="form-field">
                                <label>Serie CI</label>
                                <SfTextBox @bind-Value="@personalFormModel.Serie_CI" 
                                          Placeholder="Ex: AB" 
                                          Width="100%"
                                          MaxLength="10">
                                </SfTextBox>
                            </div>

                            <div class="form-field">
                                <label>Numar CI</label>
                                <SfTextBox @bind-Value="@personalFormModel.Numar_CI" 
                                          Placeholder="Ex: 123456" 
                                          Width="100%"
                                          MaxLength="20">
                                </SfTextBox>
                            </div>

                            <div class="form-field full-width">
                                <label>Eliberat CI De</label>
                                <SfTextBox @bind-Value="@personalFormModel.Eliberat_CI_De" 
                                          Placeholder="Ex: SPCLEP Bucuresti" 
                                          Width="100%"
                                          MaxLength="100">
                                </SfTextBox>
                            </div>

                            <div class="form-field">
                                <label>Data Eliberare CI</label>
                                <SfDatePicker @bind-Value="@personalFormModel.Data_Eliberare_CI" 
                                             Format="dd/MM/yyyy" 
                                             Width="100%">
                                </SfDatePicker>
                            </div>

                            <div class="form-field">
                                <label>Valid CI Pana</label>
                                <SfDatePicker @bind-Value="@personalFormModel.Valabil_CI_Pana" 
                                             Format="dd/MM/yyyy" 
                                             Width="100%">
                                </SfDatePicker>
                            </div>
                        </div>
                    </div>
                </div>

                @* Observatii Card *@
                <div class="detail-card observations-card">
                    <div class="card-header">
                        <i class="fas fa-sticky-note"></i>
                        <h3>Observatii</h3>
                    </div>
                    <div class="card-content">
                        <div class="form-grid">
                            <div class="form-field full-width">
                                <label>Observatii</label>
                                <SfTextBox @bind-Value="@personalFormModel.Observatii" 
                                          Placeholder="Observatii generale despre angajat..." 
                                          Width="100%"
                                          Multiline="true">
                                </SfTextBox>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </EditForm>
    </div>
</div>
