@rendermode InteractiveServer
@using ValyanClinic.Application.Features.ConsultatieManagement.Commands.CreateConsultatie
@using ValyanClinic.Application.Features.PacientManagement.Queries.GetPacientById
@using ValyanClinic.Application.Features.ProgramareManagement.DTOs

<div class="modal-overlay @(IsVisible ? "visible" : "")" @onclick="HandleOverlayClick">
    <div class="modal-container consultatie-modal @(IsVisible ? "show" : "")" @onclick:stopPropagation>
            
            <!-- MODAL HEADER -->
            <div class="modal-header">
                <div class="header-info">
                    <h4 class="modal-title">
                        <i class="fas fa-stethoscope"></i>
                        Consultatie Medicala
                    </h4>
                    <div class="patient-info-header">
                        <span class="patient-name">@PacientInfo?.NumeComplet</span>
                        <span class="patient-details">
                            @PacientInfo?.Varsta ani | CNP: @PacientInfo?.CNP
                        </span>
                    </div>
                </div>
                <div class="header-actions">
                    <span class="consultatie-date">
                        <i class="fas fa-calendar"></i>
                        @DateTime.Now.ToString("dd.MM.yyyy HH:mm")
                    </span>
                    <button type="button" class="btn-close" @onclick="CloseModal" aria-label="Close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- MODAL BODY -->
            <div class="modal-body">
                <EditForm Model="@Model" OnValidSubmit="HandleSubmit">
                    <DataAnnotationsValidator />

                    <!-- PROGRESS INDICATOR -->
                    <div class="section-progress">
                        <div class="progress-steps">
                            @foreach (var section in Sections)
                            {
                                <div class="progress-step @(CurrentSection == section ? "active" : "") @(CompletedSections.Contains(section) ? "completed" : "")">
                                    <div class="step-icon">
                                        @if (CompletedSections.Contains(section))
                                        {
                                            <i class="fas fa-check"></i>
                                        }
                                        else
                                        {
                                            <span>@(Sections.IndexOf(section) + 1)</span>
                                        }
                                    </div>
                                    <span class="step-label">@GetSectionLabel(section)</span>
                                </div>
                            }
                        </div>
                    </div>

                    <!-- TABS NAVIGATION -->
                    <ul class="nav nav-tabs consultatie-tabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link @(ActiveTab == "motive" ? "active" : "")" 
                                    type="button" 
                                    @onclick='() => ActiveTab = "motive"'>
                                <i class="fas fa-clipboard-list"></i>
                                Motive Prezentare
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link @(ActiveTab == "antecedente" ? "active" : "")" 
                                    type="button" 
                                    @onclick='() => ActiveTab = "antecedente"'>
                                <i class="fas fa-history"></i>
                                Antecedente
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link @(ActiveTab == "examen" ? "active" : "")" 
                                    type="button" 
                                    @onclick='() => ActiveTab = "examen"'>
                                <i class="fas fa-heartbeat"></i>
                                Examen Obiectiv
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link @(ActiveTab == "investigatii" ? "active" : "")" 
                                    type="button" 
                                    @onclick='() => ActiveTab = "investigatii"'>
                                <i class="fas fa-vial"></i>
                                Investigatii
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link @(ActiveTab == "diagnostic" ? "active" : "")" 
                                    type="button" 
                                    @onclick='() => ActiveTab = "diagnostic"'>
                                <i class="fas fa-diagnoses"></i>
                                Diagnostic
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link @(ActiveTab == "tratament" ? "active" : "")" 
                                    type="button" 
                                    @onclick='() => ActiveTab = "tratament"'>
                                <i class="fas fa-pills"></i>
                                Tratament
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link @(ActiveTab == "concluzie" ? "active" : "")" 
                                    type="button" 
                                    @onclick='() => ActiveTab = "concluzie"'>
                                <i class="fas fa-check-circle"></i>
                                Concluzie
                            </button>
                        </li>
                    </ul>

                    <!-- TAB CONTENT -->
                    <div class="tab-content consultatie-content">

                        <!-- TAB 1: MOTIVE PREZENTARE -->
                        <div class="tab-pane @(ActiveTab == "motive" ? "active show" : "")">
                            <div class="section-card">
                                <h5 class="section-title">
                                    <i class="fas fa-clipboard-list"></i>
                                    I. Motive Prezentare si Istoric
                                </h5>
                                
                                <div class="form-group">
                                    <label for="motivPrezentare">Motivul Prezentarii *</label>
                                    <textarea id="motivPrezentare" 
                                              class="form-control" 
                                              rows="3"
                                              placeholder="Descrie motivul pentru care pacientul se prezinta la consultatie..."
                                              @bind="Model.MotivPrezentare"></textarea>
                                    <small class="form-text">Simptomele principale pentru care se prezinta pacientul</small>
                                </div>

                                <div class="form-group">
                                    <label for="istoricBoala">Istoricul Bolii Actuale</label>
                                    <textarea id="istoricBoala" 
                                              class="form-control" 
                                              rows="5"
                                              placeholder="Descrie evolutia simptomelor, debutul, factori declansatori, evolutie..."
                                              @bind="Model.IstoricBoalaActuala"></textarea>
                                    <small class="form-text">Cand au debutat simptomele, cum au evoluat, ce tratamente au fost incercate</small>
                                </div>
                            </div>
                        </div>

                        <!-- TAB 2: ANTECEDENTE -->
                        <div class="tab-pane @(ActiveTab == "antecedente" ? "active show" : "")">
                            
                            <!-- A. ANTECEDENTE HEREDO-COLATERALE -->
                            <div class="section-card">
                                <h5 class="section-title">
                                    <i class="fas fa-users"></i>
                                    A. Antecedente Heredo-Colaterale (AHC)
                                </h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Mama</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Boli cunoscute ale mamei..."
                                                      @bind="Model.AHC_Mama"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Tata</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Boli cunoscute ale tatalui..."
                                                      @bind="Model.AHC_Tata"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Frati</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Boli cunoscute la frati..."
                                                      @bind="Model.AHC_Frati"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Bunici</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Boli cunoscute la bunici..."
                                                      @bind="Model.AHC_Bunici"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label>Alte Rude</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Alte boli ereditare in familie..."
                                                      @bind="Model.AHC_Altele"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- B. ANTECEDENTE FIZIOLOGICE -->
                            <div class="section-card">
                                <h5 class="section-title">
                                    <i class="fas fa-baby"></i>
                                    B. Antecedente Fiziologice (AF)
                                </h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Nastere</label>
                                            <input type="text" class="form-control" 
                                                   placeholder="La termen, prematur, CS..."
                                                   @bind="Model.AF_Nastere" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Dezvoltare</label>
                                            <input type="text" class="form-control" 
                                                   placeholder="Normala, intarziata..."
                                                   @bind="Model.AF_Dezvoltare" />
                                        </div>
                                    </div>

                                    @if (PacientInfo?.Sex == "F")
                                    {
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>Menstruatie</label>
                                                <input type="text" class="form-control" 
                                                       placeholder="Varsta debut, regularitate..."
                                                       @bind="Model.AF_Menstruatie" />
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>Sarcini</label>
                                                <input type="text" class="form-control" 
                                                       placeholder="Numar sarcini, nasteri..."
                                                       @bind="Model.AF_Sarcini" />
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>Alaptare</label>
                                                <input type="text" class="form-control" 
                                                       placeholder="Durata alaptarii..."
                                                       @bind="Model.AF_Alaptare" />
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>

                            <!-- C. ANTECEDENTE PERSONALE PATOLOGICE -->
                            <div class="section-card">
                                <h5 class="section-title">
                                    <i class="fas fa-notes-medical"></i>
                                    C. Antecedente Personale Patologice (APP)
                                </h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Boli Copilarie/Adolescenta</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Rujeola, varicela, oreion..."
                                                      @bind="Model.APP_BoliCopilarieAdolescenta"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Boli Adult</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Diabet, HTA, boli cronice..."
                                                      @bind="Model.APP_BoliAdult"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Interventii Chirurgicale</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Tip interventie, data..."
                                                      @bind="Model.APP_Interventii"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Traumatisme</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Fracturi, traumatisme craniene..."
                                                      @bind="Model.APP_Traumatisme"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Transfuzii</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Data, motiv..."
                                                      @bind="Model.APP_Transfuzii"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Alergii</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Alergii medicamentoase, alimentare..."
                                                      @bind="Model.APP_Alergii"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label>Medicatie Curenta</label>
                                            <textarea class="form-control" rows="3" 
                                                      placeholder="Lista medicamentelor luate in prezent..."
                                                      @bind="Model.APP_Medicatie"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- D. CONDITII SOCIO-ECONOMICE -->
                            <div class="section-card">
                                <h5 class="section-title">
                                    <i class="fas fa-home"></i>
                                    D. Conditii Socio-Economice
                                </h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Profesie</label>
                                            <input type="text" class="form-control" 
                                                   placeholder="Profesie curenta..."
                                                   @bind="Model.Profesie" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Conditii Munca</label>
                                            <input type="text" class="form-control" 
                                                   placeholder="Conditii de munca, expuneri..."
                                                   @bind="Model.ConditiiMunca" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Conditii Locuinta</label>
                                            <input type="text" class="form-control" 
                                                   placeholder="Conditii de locuit..."
                                                   @bind="Model.ConditiiLocuinta" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Obiceiuri Alimentare</label>
                                            <input type="text" class="form-control" 
                                                   placeholder="Dieta, obiceiuri alimentare..."
                                                   @bind="Model.ObiceiuriAlimentare" />
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label>Toxice (Tutun, Alcool, Droguri)</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Fumat, alcool, alte substante..."
                                                      @bind="Model.Toxice"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- TAB 3: EXAMEN OBIECTIV -->
                        <div class="tab-pane @(ActiveTab == "examen" ? "active show" : "")">
                            
                            <!-- EXAMEN GENERAL -->
                            <div class="section-card">
                                <h5 class="section-title">
                                    <i class="fas fa-user-check"></i>
                                    A. Examen General
                                </h5>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>Stare Generala</label>
                                            <select class="form-control" @bind="Model.StareGenerala">
                                                <option value="">Selecteaza...</option>
                                                <option value="Buna">Buna</option>
                                                <option value="Medie">Medie</option>
                                                <option value="Alterata">Alterata</option>
                                                <option value="Grava">Grava</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>Constitutie</label>
                                            <select class="form-control" @bind="Model.Constitutie">
                                                <option value="">Selecteaza...</option>
                                                <option value="Normolinica">Normolinica</option>
                                                <option value="Hipostenica">Hipostenica</option>
                                                <option value="Hiperstenica">Hiperstenica</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>Atitudine</label>
                                            <select class="form-control" @bind="Model.Atitudine">
                                                <option value="">Selecteaza...</option>
                                                <option value="Activa">Activa</option>
                                                <option value="Pasiva">Pasiva</option>
                                                <option value="Fortata">Fortata</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Facies</label>
                                            <input type="text" class="form-control" 
                                                   placeholder="Aspect fata: normal, suferind..."
                                                   @bind="Model.Facies" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Tegumente</label>
                                            <input type="text" class="form-control" 
                                                   placeholder="Aspect piele: normale, palide, ictere..."
                                                   @bind="Model.Tegumente" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Mucoase</label>
                                            <input type="text" class="form-control" 
                                                   placeholder="Aspect mucoase: normale, palide..."
                                                   @bind="Model.Mucoase" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Ganglioni Limfatici</label>
                                            <input type="text" class="form-control" 
                                                   placeholder="Nepalpabili, marite..."
                                                   @bind="Model.GangliniLimfatici" />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- SEMNE VITALE -->
                            <div class="section-card">
                                <h5 class="section-title">
                                    <i class="fas fa-heartbeat"></i>
                                    B. Semne Vitale si Masuratori
                                </h5>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label>Greutate (kg)</label>
                                            <input type="number" step="0.1" class="form-control" 
                                                   placeholder="kg"
                                                   @bind="Model.Greutate" 
                                                   @oninput="CalculateIMC" />
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label>Inaltime (cm)</label>
                                            <input type="number" step="0.1" class="form-control" 
                                                   placeholder="cm"
                                                   @bind="Model.Inaltime" 
                                                   @oninput="CalculateIMC" />
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label>IMC</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" 
                                                       value="@CalculatedIMC" 
                                                       readonly />
                                                <span class="input-group-text">@IMCInterpretation</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label>Temperatura (°C)</label>
                                            <input type="number" step="0.1" class="form-control" 
                                                   placeholder="°C"
                                                   @bind="Model.Temperatura" />
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label>Tensiune Arteriala</label>
                                            <input type="text" class="form-control" 
                                                   placeholder="120/80 mmHg"
                                                   @bind="Model.TensiuneArteriala" />
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label>Puls (bpm)</label>
                                            <input type="number" class="form-control" 
                                                   placeholder="bpm"
                                                   @bind="Model.Puls" />
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label>Frecv. Respiratorie (/min)</label>
                                            <input type="number" class="form-control" 
                                                   placeholder="/min"
                                                   @bind="Model.FreccventaRespiratorie" />
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label>Saturatie O2 (%)</label>
                                            <input type="number" class="form-control" 
                                                   placeholder="%"
                                                   @bind="Model.SaturatieO2" />
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label>Glicemie (mg/dL)</label>
                                            <input type="number" step="0.1" class="form-control" 
                                                   placeholder="mg/dL"
                                                   @bind="Model.Glicemie" />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- EXAMEN PE APARATE -->
                            <div class="section-card">
                                <h5 class="section-title">
                                    <i class="fas fa-stethoscope"></i>
                                    C. Examen pe Aparate si Sisteme
                                </h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Aparat Cardiovascular</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="ZGC normale, fara sufluri..."
                                                      @bind="Model.ExamenCardiovascular"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Aparat Respiratoriu</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="MV prezent bilateral, fara raluri..."
                                                      @bind="Model.ExamenRespiratoriu"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Aparat Digestiv</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Abdomen plan, ficat nepalpabil..."
                                                      @bind="Model.ExamenDigestiv"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Aparat Urinar</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="FLA libere, loja renala nedureroasa..."
                                                      @bind="Model.ExamenUrinar"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Sistem Nervos</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Constienta prezenta, ROT vii..."
                                                      @bind="Model.ExamenNervos"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Aparat Locomotor</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Mobilitate articulara normala..."
                                                      @bind="Model.ExamenLocomotor"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Sistem Endocrin</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Tiroida nepalpabila..."
                                                      @bind="Model.ExamenEndocrin"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>ORL</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Faringe normal..."
                                                      @bind="Model.ExamenORL"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Oftalmologic</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Conjunctive rosate..."
                                                      @bind="Model.ExamenOftalmologic"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Dermatologic</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Piele integra..."
                                                      @bind="Model.ExamenDermatologic"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- TAB 4: INVESTIGATII -->
                        <div class="tab-pane @(ActiveTab == "investigatii" ? "active show" : "")">
                            <div class="section-card">
                                <h5 class="section-title">
                                    <i class="fas fa-vial"></i>
                                    IV. Investigatii Efectuate
                                </h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Investigatii Laborator</label>
                                            <textarea class="form-control" rows="4" 
                                                      placeholder="Hemoleucograma, VSH, transaminaze..."
                                                      @bind="Model.InvestigatiiLaborator"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Investigatii Imagistice</label>
                                            <textarea class="form-control" rows="4" 
                                                      placeholder="Radiografie, ecografie, CT..."
                                                      @bind="Model.InvestigatiiImagistice"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>EKG</label>
                                            <textarea class="form-control" rows="4" 
                                                      placeholder="Ritm sinusal, fara modificari ST-T..."
                                                      @bind="Model.InvestigatiiEKG"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Alte Investigatii</label>
                                            <textarea class="form-control" rows="4" 
                                                      placeholder="Alte investigatii efectuate..."
                                                      @bind="Model.AlteInvestigatii"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- TAB 5: DIAGNOSTIC -->
                        <div class="tab-pane @(ActiveTab == "diagnostic" ? "active show" : "")">
                            <div class="section-card">
                                <h5 class="section-title">
                                    <i class="fas fa-diagnoses"></i>
                                    V. Diagnostic
                                </h5>
                                <div class="row">
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label>Diagnostic Pozitiv *</label>
                                            <textarea class="form-control" rows="3" 
                                                      placeholder="Diagnosticul principal stabilit..."
                                                      @bind="Model.DiagnosticPozitiv"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Diagnostic Diferential</label>
                                            <textarea class="form-control" rows="3" 
                                                      placeholder="Alternative diagnostice considerate..."
                                                      @bind="Model.DiagnosticDiferential"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Diagnostic Etiologic</label>
                                            <textarea class="form-control" rows="3" 
                                                      placeholder="Cauza bolii..."
                                                      @bind="Model.DiagnosticEtiologic"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label>Coduri ICD-10</label>
                                            <input type="text" class="form-control" 
                                                   placeholder="Ex: I10, E11.9 (separate prin virgula)"
                                                   @bind="Model.CoduriICD10" />
                                            <small class="form-text">Codurile ICD-10 pentru diagnostic</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- TAB 6: TRATAMENT -->
                        <div class="tab-pane @(ActiveTab == "tratament" ? "active show" : "")">
                            <div class="section-card">
                                <h5 class="section-title">
                                    <i class="fas fa-pills"></i>
                                    VI. Tratament si Recomandari
                                </h5>
                                <div class="row">
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label>Tratament Medicamentos</label>
                                            <textarea class="form-control" rows="4" 
                                                      placeholder="Lista medicamente prescrise cu dozaj si durata..."
                                                      @bind="Model.TratamentMedicamentos"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label>Tratament Nemedicamentos</label>
                                            <textarea class="form-control" rows="3" 
                                                      placeholder="Fizioterapie, recuperare, etc..."
                                                      @bind="Model.TratamentNemedicamentos"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Recomandari Dietetice</label>
                                            <textarea class="form-control" rows="3" 
                                                      placeholder="Dieta recomandata..."
                                                      @bind="Model.RecomandariDietetice"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Recomandari Regim de Viata</label>
                                            <textarea class="form-control" rows="3" 
                                                      placeholder="Activitate fizica, repaus..."
                                                      @bind="Model.RecomandariRegimViata"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label>Investigatii Recomandate</label>
                                            <textarea class="form-control" rows="3" 
                                                      placeholder="Investigatii suplimentare necesare..."
                                                      @bind="Model.InvestigatiiRecomandate"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Consulturi de Specialitate</label>
                                            <textarea class="form-control" rows="3" 
                                                      placeholder="Trimiteri la alte specialitati..."
                                                      @bind="Model.ConsulturiSpecialitate"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Data Urmatoarei Programari</label>
                                            <input type="text" class="form-control" 
                                                   placeholder="Ex: 1 luna, 3 luni..."
                                                   @bind="Model.DataUrmatoareiProgramari" />
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label>Recomandari Supraveghere</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Ce trebuie supravegheat in evolutie..."
                                                      @bind="Model.RecomandariSupraveghere"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- TAB 7: CONCLUZIE -->
                        <div class="tab-pane @(ActiveTab == "concluzie" ? "active show" : "")">
                            <div class="section-card">
                                <h5 class="section-title">
                                    <i class="fas fa-check-circle"></i>
                                    VII. Prognostic si Concluzie
                                </h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Prognostic</label>
                                            <select class="form-control" @bind="Model.Prognostic">
                                                <option value="">Selecteaza...</option>
                                                <option value="Favorabil">Favorabil</option>
                                                <option value="Rezervat">Rezervat</option>
                                                <option value="Sever">Sever</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label>Concluzie</label>
                                            <textarea class="form-control" rows="4" 
                                                      placeholder="Rezumat consultatie si plan terapeutic..."
                                                      @bind="Model.Concluzie"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label>Observatii Medic</label>
                                            <textarea class="form-control" rows="3" 
                                                      placeholder="Note suplimentare pentru dosar medical..."
                                                      @bind="Model.ObservatiiMedic"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label>Note Pacient</label>
                                            <textarea class="form-control" rows="2" 
                                                      placeholder="Informatii mentionate de pacient..."
                                                      @bind="Model.NotePacient"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MODAL FOOTER -->
                    <div class="modal-footer">
                        <div class="footer-left">
                            <button type="button" class="btn btn-secondary" @onclick="SaveDraft">
                                <i class="fas fa-save"></i>
                                Salveaza Draft
                            </button>
                            <button type="button" class="btn btn-info" @onclick="PreviewScrisoare">
                                <i class="fas fa-eye"></i>
                                Preview Scrisoare
                            </button>
                        </div>
                        <div class="footer-right">
                            <button type="button" class="btn btn-outline-secondary" @onclick="CloseModal">
                                Anuleaza
                            </button>
                            <button type="submit" class="btn btn-primary" disabled="@IsSaving">
                                @if (IsSaving)
                                {
                                    <span class="spinner-border spinner-border-sm me-2"></span>
                                }
                                <i class="fas fa-check"></i>
                                Finalizeaza Consultatie
                            </button>
                        </div>
                    </div>
                </EditForm>
            </div>
    </div>
</div>

@if (IsVisible)
{
    <div class="modal-backdrop fade show"></div>
}
