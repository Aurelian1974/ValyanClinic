@page "/login"
@attribute [Microsoft.AspNetCore.Authorization.AllowAnonymous]
@* ✅ DISABLE PRERENDERING pentru experiență mai smooth *@
@rendermode @(new InteractiveServerRenderMode(prerender: false))
@layout EmptyLayout

<PageTitle>Autentificare - ValyanClinic</PageTitle>

<div class="login-container">
    <div class="login-card">
        <!-- Logo & Header -->
        <div class="login-header">
            <div class="logo-container" aria-label="Logo ValyanClinic">
                <i class="fas fa-hospital-symbol" aria-hidden="true"></i>
            </div>
            <h1>ValyanClinic</h1>
            <p class="subtitle">Sistem de Management Clinic</p>
        </div>

        <!-- Error Message -->
        @if (HasError)
        {
            <div class="alert alert-danger fade-in" role="alert" aria-live="polite">
                <i class="fas fa-exclamation-circle" aria-hidden="true"></i>
                <span>@ErrorMessage</span>
            </div>
        }

        <!-- Login Form -->
        <EditForm Model="@LoginModel" OnValidSubmit="@HandleLoginAsync" class="login-form">
            <DataAnnotationsValidator />
            
            <!-- ✅ ValidationSummary for all validation errors -->
            <ValidationSummary class="validation-summary" />

            <!-- Username Field -->
            <div class="form-group">
                <label for="username">
                    <i class="fas fa-user" aria-hidden="true"></i>
                    Nume utilizator
                </label>
                <div class="input-wrapper">
                    <input 
                        type="text" 
                        id="username"
                        name="username"
                        class="form-control"
                        placeholder="Introduceti numele de utilizator"
                        autocomplete="username"
                        aria-required="true"
                        aria-describedby="username-error"
                        @bind="LoginModel.Username"
                        @bind:event="oninput"
                        disabled="@IsLoading" />
                </div>
                <ValidationMessage For="@(() => LoginModel.Username)" class="validation-error" id="username-error" />
            </div>

            <!-- Password Field -->
            <div class="form-group">
                <label for="password">
                    <i class="fas fa-lock" aria-hidden="true"></i>
                    Parola
                </label>
                <div class="input-wrapper password-wrapper">
                    <input 
                        type="@PasswordInputType" 
                        id="password"
                        name="password"
                        class="form-control"
                        placeholder="Introduceti parola"
                        autocomplete="current-password"
                        aria-required="true"
                        aria-describedby="password-error"
                        @bind="LoginModel.Password"
                        @bind:event="oninput"
                        disabled="@IsLoading" />
                    <button 
                        type="button" 
                        class="btn-toggle-password"
                        aria-label="@PasswordToggleAriaLabel"
                        title="@PasswordToggleTitle"
                        @onclick="TogglePasswordVisibility"
                        tabindex="-1">
                        <i class="fas @PasswordToggleIcon" aria-hidden="true"></i>
                    </button>
                </div>
                <ValidationMessage For="@(() => LoginModel.Password)" class="validation-error" id="password-error" />
            </div>

            <!-- Remember Me & Reset Password Checkboxes -->
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <label class="checkbox-label">
                        <input 
                            type="checkbox"
                            id="remember-me"
                            name="remember-me"
                            @bind="LoginModel.RememberMe" 
                            disabled="@IsLoading" />
                        <span class="checkbox-text">
                            <i class="fas fa-save" aria-hidden="true"></i>
                            Tine minte nume utilizator
                        </span>
                    </label>
                </div>
                
                <div class="checkbox-item">
                    <label class="checkbox-label">
                        <input 
                            type="checkbox"
                            id="reset-password"
                            name="reset-password"
                            @bind="LoginModel.ResetPasswordOnFirstLogin" 
                            disabled="@IsLoading" />
                        <span class="checkbox-text">
                            <i class="fas fa-key" aria-hidden="true"></i>
                            Reseteaza parola la prima logare
                        </span>
                    </label>
                </div>
            </div>

            <!-- Login Button -->
            <button 
                type="submit" 
                class="btn btn-primary btn-login"
                aria-label="@LoginButtonAriaLabel"
                disabled="@IsLoading">
                @if (IsLoading)
                {
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                    <span class="ms-2">Se autentifica...</span>
                }
                else
                {
                    <i class="fas fa-sign-in-alt" aria-hidden="true"></i>
                    <span>Autentificare</span>
                }
            </button>

            <!-- Additional Links -->
            <div class="login-footer">
                <a href="#" 
                   class="forgot-password" 
                   aria-label="Link pentru recuperare parola"
                   @onclick:preventDefault 
                   @onclick="HandleForgotPasswordAsync">
                    <i class="fas fa-question-circle" aria-hidden="true"></i>
                    Ai uitat parola?
                </a>
            </div>
        </EditForm>
    </div>

    <!-- Background Decorations -->
    <div class="background-decoration" aria-hidden="true">
        <div class="circle circle-1"></div>
        <div class="circle circle-2"></div>
        <div class="circle circle-3"></div>
    </div>
</div>
