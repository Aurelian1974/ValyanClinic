@page "/monitorizare/sesiuni-active"
@using ValyanClinic.Application.Features.Settings.Queries.GetActiveSessions
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.Buttons
@attribute [Authorize]

<PageTitle>Sesiuni Active - ValyanClinic</PageTitle>

<div class="page-container">
 <div class="page-header">
   <h3 class="page-title">
 <i class="fas fa-users"></i>
      Sesiuni Active Utilizatori
    </h3>
   <SfButton CssClass="e-success" OnClick="RefreshSessions">
   <i class="fas fa-sync"></i> Reincarca
 </SfButton>
    </div>

    <div class="stats-panel">
   <div class="stat-card">
   <div class="stat-icon">
    <i class="fas fa-users"></i>
     </div>
  <div class="stat-content">
      <div class="stat-value">@Sessions.Count</div>
    <div class="stat-label">Sesiuni Active</div>
  </div>
     </div>
  <div class="stat-card">
   <div class="stat-icon warning">
    <i class="fas fa-exclamation-triangle"></i>
 </div>
 <div class="stat-content">
 <div class="stat-value">@ExpiringSoonCount</div>
        <div class="stat-label">Expira in curand</div>
   </div>
   </div>
  </div>

    @if (IsLoading)
    {
 <div class="loading-container">
       <div class="spinner-border text-primary" role="status"></div>
</div>
    }
    else
    {
   <div class="sessions-grid">
    <SfGrid @ref="GridRef" 
 DataSource="@Sessions"
   AllowPaging="true"
    AllowSorting="true">
    <GridPageSettings PageSize="20"></GridPageSettings>
 <GridColumns>
  <GridColumn Field="@nameof(UserSessionDto.DataCreare)" 
   HeaderText="Data Creare" 
      Format="dd/MM/yyyy HH:mm"
       Width="150"></GridColumn>
     <GridColumn Field="@nameof(UserSessionDto.DataUltimaActivitate)" 
   HeaderText="Ultima Activitate" 
     Format="dd/MM/yyyy HH:mm"
     Width="170"></GridColumn>
  <GridColumn Field="@nameof(UserSessionDto.AdresaIP)" 
      HeaderText="Adresa IP" 
Width="130"></GridColumn>
    <GridColumn Field="@nameof(UserSessionDto.Dispozitiv)" 
    HeaderText="Dispozitiv" 
     Width="150"></GridColumn>
   <GridColumn Field="@nameof(UserSessionDto.DataExpirare)" 
    HeaderText="Expira la" 
  Format="dd/MM/yyyy HH:mm"
   Width="150">
   <Template>
        @{
     var session = (context as UserSessionDto);
   var minutesLeft = session != null ? (session.DataExpirare - DateTime.UtcNow).TotalMinutes : 0;
     var badgeClass = minutesLeft < 5 ? "badge-warning" : "badge-success";
    <span class="@badgeClass">
      @session?.DataExpirare.ToString("HH:mm")
    </span>
 }
       </Template>
      </GridColumn>
     </GridColumns>
   </SfGrid>
    </div>
    }
</div>
